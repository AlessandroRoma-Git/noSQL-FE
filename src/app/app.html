
<div class="flex h-screen">
  <!-- Sidebar -->
  @if (authService.isAuthenticated$ | async) {
    <aside
      class="fixed top-0 left-0 h-full w-64 bg-[rgb(var(--color-bg-surface))] flex flex-col transition-transform duration-300 ease-in-out z-40"
      [class.translate-x-0]="isSidebarOpen"
      [class.-translate-x-full]="!isSidebarOpen">

      <div class="flex items-center justify-center h-16 border-b border-[rgb(var(--color-bg-base))] text-xl font-semibold">
        CMS Config
      </div>
      <nav class="flex flex-col flex-grow p-4 space-y-2">
        <a routerLink="/dashboard" routerLinkActive="active-link" class="nav-link">Dashboard</a>
        <a routerLink="/entity-definitions" routerLinkActive="active-link" class="nav-link">Entities</a>
        <a routerLink="/email-templates" routerLinkActive="active-link" class="nav-link">Email Templates</a>
        <a routerLink="/groups" routerLinkActive="active-link" class="nav-link">Groups</a>
        <a routerLink="/users" routerLinkActive="active-link" class="nav-link">Users</a>
        <a routerLink="/menu" routerLinkActive="active-link" class="nav-link">Menu</a>
      </nav>

      <!-- Theme Selector -->
      <div class="p-4 border-t border-[rgb(var(--color-bg-base))]">
        <label for="theme-selector" class="block text-sm font-medium text-[rgb(var(--color-text))] mb-2">Theme</label>
        <select id="theme-selector" class="input w-full" (change)="onThemeChange($event)">
          @for (theme of themes; track theme.id) {
            <option [value]="theme.id" [selected]="theme.id === (activeTheme$ | async)">
              {{ theme.name }}
            </option>
          }
        </select>
      </div>

      <div class="p-4 border-t border-[rgb(var(--color-bg-base))]">
        <button (click)="logout()" class="w-full px-4 py-2 text-sm font-medium text-white bg-[rgb(var(--color-accent))] rounded-md hover:opacity-80">
          Logout
        </button>
      </div>
    </aside>
  }

  <!-- Main Content -->
  <div class="flex-1 flex flex-col transition-all duration-300 ease-in-out"
       [class.md:ml-64]="isSidebarOpen && (authService.isAuthenticated$ | async)">

    <!-- Floating Circle Toggle Button -->
    @if (authService.isAuthenticated$ | async) {
      <button
        (click)="toggleSidebar()"
        class="fixed top-6 z-50 p-2 rounded-full bg-[rgb(var(--color-bg-surface))] hover:bg-[rgb(var(--color-bg-base))] transition-all duration-300 ease-in-out"
        [class.left-64]="isSidebarOpen"
        [class.-translate-x-1/2]="isSidebarOpen"
        [class.left-4]="!isSidebarOpen">

        @if (isSidebarOpen) {
          <!-- Left Arrow (Close) -->
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
        } @else {
          <!-- Right Arrow (Open) -->
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        }
      </button>
    }

    <!-- Content Area -->
    <main class="flex-1 p-4 pt-16 overflow-y-auto">
      <router-outlet></router-outlet>
    </main>
  </div>
</div>

<app-modal></app-modal>
