
<div class="container mx-auto p-4">
  <h1 class="text-3xl font-bold mb-6">Create Email Template</h1>
  <form [formGroup]="editorForm" (ngSubmit)="onSubmit()" class="space-y-8">

    <!-- Main Details -->
    <div class="bg-white p-6 rounded-lg shadow-md">
      <div class="flex justify-between items-center border-b pb-2 mb-4">
        <h2 class="text-xl font-semibold">Template Details</h2>
        <button type="button" (click)="showInfo('Template Details', 'Here you can define the main properties of your email template.')" class="info-button">i</button>
      </div>
      <div class="space-y-4">
        <div>
          <label for="name" class="label">Template Name</label>
          <input formControlName="name" id="name" type="text" class="input" placeholder="e.g., welcome_email">
        </div>

        <!-- Editor Tabs -->
        <div>
          <label class="label">HTML Content</label>
          <div class="border border-gray-300 rounded-md">
            <div class="flex border-b">
              <button type="button" (click)="activeTab = 'editor'" [class.active-tab]="activeTab === 'editor'" class="tab-button">Editor</button>
              <button type="button" (click)="activeTab = 'html'" [class.active-tab]="activeTab === 'html'" class="tab-button">HTML</button>
            </div>
            <div [ngSwitch]="activeTab">
              <div *ngSwitchCase="'editor'">
                <editor formControlName="htmlContent" [init]="tinyMceConfig"></editor>
              </div>
              <div *ngSwitchCase="'html'">
                <textarea formControlName="htmlContent" rows="15" class="input rounded-t-none border-0"></textarea>
              </div>
            </div>
          </div>
          <p class="text-xs text-gray-500 mt-1" ngNonBindable>Use {{placeholder_name}} for placeholders.</p>
        </div>

      </div>
    </div>

    <!-- Placeholders & Attachments -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- Placeholders -->
      <div class="bg-white p-6 rounded-lg shadow-md" formArrayName="placeholders">
        <div class="flex justify-between items-center border-b pb-2 mb-4">
          <h2 class="text-xl font-semibold">Placeholders</h2>
          <button type="button" (click)="showInfo('Placeholders', 'Define the dynamic parts of your email. These will be replaced with actual data when the email is sent.')" class="info-button">i</button>
        </div>
        <div *ngFor="let placeholder of placeholders.controls; let i = index" class="flex items-center space-x-2 mb-2">
          <input [formControlName]="i" class="input flex-grow" placeholder="e.g., user_name">
          <button type="button" (click)="removePlaceholder(i)" class="button-danger-sm">Remove</button>
        </div>
        <button type="button" (click)="addPlaceholder()" class="button-secondary-sm mt-2">Add Placeholder</button>
      </div>

      <!-- Attachments -->
      <div class="bg-white p-6 rounded-lg shadow-md" formArrayName="attachments">
        <div class="flex justify-between items-center border-b pb-2 mb-4">
          <h2 class="text-xl font-semibold">Attachments</h2>
          <button type="button" (click)="showInfo('Attachments', 'Add files that will be sent along with the email. The files will be converted to Base64.')" class="info-button">i</button>
        </div>
        <div *ngFor="let attachment of attachments.controls; let i = index" [formGroupName]="i" class="space-y-2 p-4 border rounded-md bg-gray-50 mb-2">
           <div class="flex justify-end">
              <button type="button" (click)="removeAttachment(i)" class="text-red-500 hover:underline font-semibold">Remove</button>
          </div>
          <div>
              <label class="label">File</label>
              <input type="file" (change)="onFileChange($event, i)" class="input">
          </div>
          <div>
              <label class="label">Filename</label>
              <input formControlName="filename" class="input bg-gray-100" readonly>
          </div>
        </div>
         <button type="button" (click)="addAttachment()" class="button-secondary-sm mt-2">Add Attachment</button>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="flex justify-end space-x-4">
      <a routerLink="/email-templates" class="button-secondary">Cancel</a>
      <button type="submit" [disabled]="editorForm.invalid" class="button-primary disabled:opacity-50">
        Create Template
      </button>
    </div>
  </form>
</div>
