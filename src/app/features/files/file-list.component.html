
<div class="container mx-auto p-4">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-2xl font-bold text-primary">File Storage</h1>
    <label class="button-primary cursor-pointer">
      <span>Upload File</span>
      <input type="file" class="hidden" (change)="onFileSelected($event)">
    </label>
  </div>

  @if (uploadProgress !== null) {
    <div class="w-full bg-base rounded-full h-2.5 mb-4">
      <div class="bg-primary h-2.5 rounded-full" [style.width.%]="uploadProgress"></div>
    </div>
  }

  @if (files$ | async; as files) {
    <div class="bg-surface shadow-md rounded-lg">
      @if (files.length > 0) {
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-base">
            <thead class="bg-base">
              <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-main-text/70 uppercase tracking-wider">Filename</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-main-text/70 uppercase tracking-wider">Content Type</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-main-text/70 uppercase tracking-wider">Size</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-main-text/70 uppercase tracking-wider">Uploaded By</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-main-text/70 uppercase tracking-wider">Date</th>
                <th scope="col" class="relative px-6 py-3"><span class="sr-only">Actions</span></th>
              </tr>
            </thead>
            <tbody class="bg-surface divide-y divide-base">
              @for (file of files; track file.id) {
                <tr class="hover:bg-base">
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-primary">{{ file.filename }}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-main-text/70">{{ file.contentType }}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-main-text/70">{{ formatBytes(file.size) }}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-main-text/70">{{ file.uploadedBy }}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-main-text/70">{{ file.createdAt | date:'short' }}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-4">
                    <a [href]="'http://localhost:8088/api/v1/files/' + file.id" target="_blank" class="text-accent hover:underline">Download</a>
                    <button (click)="onDelete(file.id, file.filename)" class="text-red-500 hover:underline">Delete</button>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      } @else {
        <p class="p-4 text-main-text/70">No files found. Click "Upload File" to get started.</p>
      }
    </div>
  } @else {
    <p>Loading...</p>
  }
</div>
