
<div class="container mx-auto p-4">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-2xl font-bold text-[rgb(var(--color-primary))]">Records for: {{ entityKey }}</h1>
    <div class="flex space-x-2">
      <button (click)="openSearchModal()" class="button-secondary">Advanced Search</button>
      <a [routerLink]="['/records', entityKey, 'new']" class="button-primary">
        Create New Record
      </a>
    </div>
  </div>

  @if (records$ | async; as records) {
    <div class="bg-surface shadow-md rounded-lg">
      @if (records.length > 0) {
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-base">
            <thead class="bg-base">
              <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-[rgb(var(--color-text))] opacity-70 uppercase tracking-wider">ID</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-[rgb(var(--color-text))] opacity-70 uppercase tracking-wider">Data</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-[rgb(var(--color-text))] opacity-70 uppercase tracking-wider">Created At</th>
                <th scope="col" class="relative px-6 py-3"><span class="sr-only">Actions</span></th>
              </tr>
            </thead>
            <tbody class="bg-surface divide-y divide-base">
              @for (record of records; track record.id) {
                <tr class="hover:bg-base">
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-[rgb(var(--color-text))] opacity-70">{{ record.id }}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-[rgb(var(--color-text))]">
                    <pre class="max-w-lg truncate"><code>{{ getJsonData(record.data) }}</code></pre>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-[rgb(var(--color-text))] opacity-70">{{ record.createdAt | date:'short' }}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-4">
                    @if (entityDefinition.historyEnabled) {
                      <button (click)="onShowHistory(record.id)" class="text-[rgb(var(--color-accent))] hover:underline">History</button>
                    }
                    <a [routerLink]="['/records', entityKey, 'edit', record.id]" class="text-[rgb(var(--color-accent))] hover:underline">Edit</a>
                    <button (click)="onDelete(record.id)" class="text-red-500 hover:underline">Delete</button>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      } @else {
        <p class="p-4 text-[rgb(var(--color-text))] opacity-70">No records found. Click "Create New Record" to get started.</p>
      }
    </div>
  } @else {
    <p>Loading...</p>
  }
</div>
